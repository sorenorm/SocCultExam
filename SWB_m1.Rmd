---
title: "Untitled"
author: "Ormo"
date: "5/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(tidyverse, 
               rethinking,
               zoo, 
               viridis,
               bayesplot)

theme_set(theme_minimal())



color_scheme_set("Spectral")
```


```{r defining variables}
# baserate consumption
br_c = as.numeric(1000)

# start wealth
start_wealth = 10000

dens(rbeta(100000, 2, 5))
dens(rbeta(100000, 5, 5))
dens(rbeta(100000, 5, 2))

# Materialism distributions
md <- data.frame(
  high = rbeta(100000, 5, 2),
  medium = rbeta(100000, 5, 5),
  low = rbeta(100000, 2, 5)
)

# Income equal or distribution? try with stable incomes
id = data.frame(
  high = rnorm(100000, mean = 20000, sd = 1000),
  medium = rnorm(100000, mean = 12500, sd = 1000),
  low = rnorm(100000, mean = 7500, sd = 1000)
)

rnorm(100000, mean = 20000, sd = 1000) %>% dens()
rnorm(100000, mean = 12500, sd = 1000) %>% dens()
rnorm(100000, mean = 7500, sd = 1000) %>% dens()

effect_c <- data.frame(
  high = rbeta(100000, 5, 2),
  medium = rbeta(100000, 5, 5),
  low = rbeta(100000, 2, 5))

x <- seq(from = 1, to = 100000, by = 1000)
y <- (x/10000)/sqrt(1 + (x/10000)^2)

data.frame(x = x, y = y) %>% 
  ggplot(aes(x, y)) +
  geom_line()

```


```{r creating agents}
create.agent <- function(type) {
  income = sample(10000:100000, 1)
  set_level = rbeta(1, 5, 5)
  
  agent <- data.frame(
    materialism = sample(1:100000, 1)/100000, # fixed materialism values
    income = income, # fixed income randomly assigned
    wealth = income * 3, # wealth at round 0
    consumption = 0, # consumption at round 0
    # social_consumption = consumption *
    # materistic_consumption = 1 - social_consumption
    pp = 0, # personal property at round 0
    swb = 0.6 * set_level + 0.4 * rbeta(1, 5, 5), # happiness at round 0 - try with Denmark as a starting point
    swb_consumption = 0,
    ID = NA,
    set_level = set_level
  )
}

```

```{r simulating rounds}
rounds = 1:100
n_agents = 5


world <- lapply(rep(1:n_agents, 1), create.agent)


for(j in 1:length(world)) {
  agent <- world[[j]]
  agent$ID[1] <- j
  for (i in rounds) {
    i = i + 1
    
    c = br_c + (agent$wealth[i - 1] - br_c) * 
      rbeta(1, 10*agent$materialism[1], 10*(1-agent$materialism[1])) # consumption
    w = agent$wealth[i - 1] + agent$income[1] - c
    pp = agent$pp[i - 1] + c
    
    swb_consumption = 0
    
    for(k in 1:(i-1)){
      swb_consumption = swb_consumption + 1/k^2 * agent$consumption[k] + c
    }
    
    swb = 0.6 * agent$set_level[1] + 0.4 * (swb_consumption/10000)/sqrt(1 + (swb_consumption/10000)^2) # consumption
    
    agent[i,] <- c(NA, NA, w, c, pp, swb, swb_consumption, NA, NA)
  }
  agent <- na.locf(agent)
  agent$round <- seq.int(nrow(agent))
  world[[j]] <- agent
}

```


```{r plots}
d <- data.frame(
    materialism = NA,
    income = NA, 
    wealth = NA, 
    consumption = NA, 
    pp = NA,
    swb = NA, 
    ID = NA,
    swb_consumption = NA,
    round = NA,
    set_level = NA
)

for(i in 1:length(world)){
  d = rbind(d, world[[i]])
}

d <- d %>% 
  na.omit() %>% 
  mutate(ID = as.factor(ID))

d %>% ggplot(aes(x = round, y = swb, color = ID)) +
  geom_line(alpha = 0.5)

d %>% ggplot(aes(x = wealth, y = swb, color = ID)) +
  geom_point(shape = 1, alpha = 0.7) +
  geom_smooth(method = 'lm')

d %>% ggplot(aes(x = round, y = wealth, color = ID)) +
  geom_line()

d %>% ggplot(aes(x = materialism, y = swb - set_level)) +
  geom_jitter(alpha = 0.2, shape = 1) +
  geom_smooth(method = 'lm')

d %>% ggplot(aes(x = consumption, y = swb - set_level, color = ID)) +
  geom_jitter(alpha = 0.2, shape = 1) +
  geom_smooth(method = 'lm')

d %>% ggplot(aes(x = consumption, y = swb_consumption, color = ID)) +
  geom_jitter(alpha = 0.8, shape = 1) +
  geom_smooth(method = 'lm')
  

```














