---
title: "Untitled"
author: "Ormo"
date: "5/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

pacman::p_load(tidyverse, rethinking, zoo)

theme_set(theme_minimal())
```


```{r defining variables}
# baserate consumption
br_c = as.numeric(1000)

# Income equal or distribution?
id = data.frame(
  high = rnorm(100000, mean = 20000, sd = 1000),
  medium = rnorm(100000, mean = 12500, sd = 1000),
  low = rnorm(100000, mean = 7500, sd = 1000)
)

# start wealth
start_wealth = 10000

# Materialism distributions

dens(rbeta(100000, 2, 5))
dens(rbeta(100000, 5, 5))
dens(rbeta(100000, 5, 2))


md <- data.frame(
  high = rbeta(100000, 5, 2),
  medium = rbeta(100000, 5, 5),
  low = rbeta(100000, 2, 5)
)

x <- seq(from = 1, to = 100000, by = 1000)
y <- (x/10000)/sqrt(1 + (x/10000)^2)

data.frame(x = x, y = y) %>% 
  ggplot(aes(x, y)) +
  geom_line()


```


```{r creating agents}
create.agent <- function(type) {
  agent <- data.frame(
    materialism = type[1], # discrete variable for now: high, medium, low - could be a distribution too
    income = type[2], # discrete variable for now: high, medium, low - could be a distribution too
    wealth = start_wealth, # wealth at round 0
    consumption = 0, # consumption at round 0
    # social_consumption = consumption *
    # materistic_consumption = 1 - social_consumption
    pp = 0, # personal property at round 0
    swb = 0.5, # happiness at round 0
    ID = NA
  )
}

```

```{r}
types <- expand.grid(materialism = c('high', 'medium', 'low'), 
                     income = c('high', 'medium', 'low')) %>% t() %>% data.frame()

world <- lapply(types, create.agent)

```



```{r simulating rounds}
rounds = 1:100

for(j in 1:length(world)) {
  agent <- world[[j]]
  agent$ID[1] <- j
  for (i in rounds) {
    i = i + 1
    
    c = br_c + (agent$wealth[i - 1] - br_c) * md[agent$materialism[1]][sample(1:100000, 1), ] # consumption
    w = agent$wealth[i - 1] + id[agent$income[1]][sample(1:100000, 1), ] - c
    pp = agent$pp[i - 1] + c
    swb = agent$swb[i - 1] * (w / 10000) / sqrt(1 + (w / 10000) ^ 2)
    ID = j
    
    agent[i,] <- c(NA, NA, w, c, pp, swb, NA)
  }
  agent <- na.locf(agent)
  agent$round <- seq.int(nrow(agent))
  world[[j]] <- agent
}

```


```{r plots}
d <- data.frame(
    materialism = NA,
    income = NA, 
    wealth = NA, 
    consumption = NA, 
    pp = NA,
    swb = NA, 
    ID = NA,
    round = NA
)

for(i in 1:length(world)){
  d = rbind(d, world[[i]])
}

d <- d %>% 
  na.omit() %>% 
  mutate(ID = as.factor(ID))

d %>% ggplot(aes(x = round, y = swb, color = ID)) +
  geom_line()

d %>% ggplot(aes(x = wealth, y = swb, color = ID)) +
  geom_point() +
  geom_smooth(method = 'lm')

```














